{"ast":null,"code":"import { CDPSessionEvent } from '../api/CDPSession.js';\nimport { TargetType } from '../api/Target.js';\nimport { WebWorker } from '../api/WebWorker.js';\nimport { TimeoutSettings } from '../common/TimeoutSettings.js';\nimport { debugError } from '../common/util.js';\nimport { ExecutionContext } from './ExecutionContext.js';\nimport { IsolatedWorld } from './IsolatedWorld.js';\nimport { CdpJSHandle } from './JSHandle.js';\n/**\n * @internal\n */\nexport class CdpWebWorker extends WebWorker {\n  #world;\n  #client;\n  #id;\n  #targetType;\n  constructor(client, url, targetId, targetType, consoleAPICalled, exceptionThrown) {\n    super(url);\n    this.#id = targetId;\n    this.#client = client;\n    this.#targetType = targetType;\n    this.#world = new IsolatedWorld(this, new TimeoutSettings());\n    this.#client.once('Runtime.executionContextCreated', async event => {\n      this.#world.setContext(new ExecutionContext(client, event.context, this.#world));\n    });\n    this.#world.emitter.on('consoleapicalled', async event => {\n      try {\n        return consoleAPICalled(event.type, event.args.map(object => {\n          return new CdpJSHandle(this.#world, object);\n        }), event.stackTrace);\n      } catch (err) {\n        debugError(err);\n      }\n    });\n    this.#client.on('Runtime.exceptionThrown', exceptionThrown);\n    this.#client.once(CDPSessionEvent.Disconnected, () => {\n      this.#world.dispose();\n    });\n    // This might fail if the target is closed before we receive all execution contexts.\n    this.#client.send('Runtime.enable').catch(debugError);\n  }\n  mainRealm() {\n    return this.#world;\n  }\n  get client() {\n    return this.#client;\n  }\n  async close() {\n    switch (this.#targetType) {\n      case TargetType.SERVICE_WORKER:\n      case TargetType.SHARED_WORKER:\n        {\n          // For service and shared workers we need to close the target and detach to allow\n          // the worker to stop.\n          await this.client.connection()?.send('Target.closeTarget', {\n            targetId: this.#id\n          });\n          await this.client.connection()?.send('Target.detachFromTarget', {\n            sessionId: this.client.id()\n          });\n          break;\n        }\n      default:\n        await this.evaluate(() => {\n          self.close();\n        });\n    }\n  }\n}","map":{"version":3,"names":["CDPSessionEvent","TargetType","WebWorker","TimeoutSettings","debugError","ExecutionContext","IsolatedWorld","CdpJSHandle","CdpWebWorker","world","client","id","targetType","constructor","url","targetId","consoleAPICalled","exceptionThrown","once","event","setContext","context","emitter","on","type","args","map","object","stackTrace","err","Disconnected","dispose","send","catch","mainRealm","close","SERVICE_WORKER","SHARED_WORKER","connection","sessionId","evaluate","self"],"sources":["C:\\Users\\raffy\\Desktop\\test\\node_modules\\puppeteer-core\\src\\cdp\\WebWorker.ts"],"sourcesContent":["/**\n * @license\n * Copyright 2018 Google Inc.\n * SPDX-License-Identifier: Apache-2.0\n */\nimport type {Protocol} from 'devtools-protocol';\n\nimport {CDPSessionEvent, type CDPSession} from '../api/CDPSession.js';\nimport type {Realm} from '../api/Realm.js';\nimport {TargetType} from '../api/Target.js';\nimport {WebWorker} from '../api/WebWorker.js';\nimport {TimeoutSettings} from '../common/TimeoutSettings.js';\nimport {debugError} from '../common/util.js';\n\nimport {ExecutionContext} from './ExecutionContext.js';\nimport {IsolatedWorld} from './IsolatedWorld.js';\nimport {CdpJSHandle} from './JSHandle.js';\n\n/**\n * @internal\n */\nexport type ConsoleAPICalledCallback = (\n  eventType: string,\n  handles: CdpJSHandle[],\n  trace?: Protocol.Runtime.StackTrace\n) => void;\n\n/**\n * @internal\n */\nexport type ExceptionThrownCallback = (\n  event: Protocol.Runtime.ExceptionThrownEvent\n) => void;\n\n/**\n * @internal\n */\nexport class CdpWebWorker extends WebWorker {\n  #world: IsolatedWorld;\n  #client: CDPSession;\n  readonly #id: string;\n  readonly #targetType: TargetType;\n\n  constructor(\n    client: CDPSession,\n    url: string,\n    targetId: string,\n    targetType: TargetType,\n    consoleAPICalled: ConsoleAPICalledCallback,\n    exceptionThrown: ExceptionThrownCallback\n  ) {\n    super(url);\n    this.#id = targetId;\n    this.#client = client;\n    this.#targetType = targetType;\n    this.#world = new IsolatedWorld(this, new TimeoutSettings());\n\n    this.#client.once('Runtime.executionContextCreated', async event => {\n      this.#world.setContext(\n        new ExecutionContext(client, event.context, this.#world)\n      );\n    });\n    this.#world.emitter.on('consoleapicalled', async event => {\n      try {\n        return consoleAPICalled(\n          event.type,\n          event.args.map((object: Protocol.Runtime.RemoteObject) => {\n            return new CdpJSHandle(this.#world, object);\n          }),\n          event.stackTrace\n        );\n      } catch (err) {\n        debugError(err);\n      }\n    });\n    this.#client.on('Runtime.exceptionThrown', exceptionThrown);\n    this.#client.once(CDPSessionEvent.Disconnected, () => {\n      this.#world.dispose();\n    });\n\n    // This might fail if the target is closed before we receive all execution contexts.\n    this.#client.send('Runtime.enable').catch(debugError);\n  }\n\n  mainRealm(): Realm {\n    return this.#world;\n  }\n\n  get client(): CDPSession {\n    return this.#client;\n  }\n\n  override async close(): Promise<void> {\n    switch (this.#targetType) {\n      case TargetType.SERVICE_WORKER:\n      case TargetType.SHARED_WORKER: {\n        // For service and shared workers we need to close the target and detach to allow\n        // the worker to stop.\n        await this.client.connection()?.send('Target.closeTarget', {\n          targetId: this.#id,\n        });\n        await this.client.connection()?.send('Target.detachFromTarget', {\n          sessionId: this.client.id(),\n        });\n        break;\n      }\n      default:\n        await this.evaluate(() => {\n          self.close();\n        });\n    }\n  }\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}