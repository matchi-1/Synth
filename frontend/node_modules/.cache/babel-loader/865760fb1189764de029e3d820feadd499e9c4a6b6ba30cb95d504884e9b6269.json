{"ast":null,"code":"import { TAG_ID as $, NS, ATTRS, getTagID } from './html.js';\n//MIME types\nconst MIME_TYPES = {\n  TEXT_HTML: 'text/html',\n  APPLICATION_XML: 'application/xhtml+xml'\n};\n//Attributes\nconst DEFINITION_URL_ATTR = 'definitionurl';\nconst ADJUSTED_DEFINITION_URL_ATTR = 'definitionURL';\nconst SVG_ATTRS_ADJUSTMENT_MAP = new Map(['attributeName', 'attributeType', 'baseFrequency', 'baseProfile', 'calcMode', 'clipPathUnits', 'diffuseConstant', 'edgeMode', 'filterUnits', 'glyphRef', 'gradientTransform', 'gradientUnits', 'kernelMatrix', 'kernelUnitLength', 'keyPoints', 'keySplines', 'keyTimes', 'lengthAdjust', 'limitingConeAngle', 'markerHeight', 'markerUnits', 'markerWidth', 'maskContentUnits', 'maskUnits', 'numOctaves', 'pathLength', 'patternContentUnits', 'patternTransform', 'patternUnits', 'pointsAtX', 'pointsAtY', 'pointsAtZ', 'preserveAlpha', 'preserveAspectRatio', 'primitiveUnits', 'refX', 'refY', 'repeatCount', 'repeatDur', 'requiredExtensions', 'requiredFeatures', 'specularConstant', 'specularExponent', 'spreadMethod', 'startOffset', 'stdDeviation', 'stitchTiles', 'surfaceScale', 'systemLanguage', 'tableValues', 'targetX', 'targetY', 'textLength', 'viewBox', 'viewTarget', 'xChannelSelector', 'yChannelSelector', 'zoomAndPan'].map(attr => [attr.toLowerCase(), attr]));\nconst XML_ATTRS_ADJUSTMENT_MAP = new Map([['xlink:actuate', {\n  prefix: 'xlink',\n  name: 'actuate',\n  namespace: NS.XLINK\n}], ['xlink:arcrole', {\n  prefix: 'xlink',\n  name: 'arcrole',\n  namespace: NS.XLINK\n}], ['xlink:href', {\n  prefix: 'xlink',\n  name: 'href',\n  namespace: NS.XLINK\n}], ['xlink:role', {\n  prefix: 'xlink',\n  name: 'role',\n  namespace: NS.XLINK\n}], ['xlink:show', {\n  prefix: 'xlink',\n  name: 'show',\n  namespace: NS.XLINK\n}], ['xlink:title', {\n  prefix: 'xlink',\n  name: 'title',\n  namespace: NS.XLINK\n}], ['xlink:type', {\n  prefix: 'xlink',\n  name: 'type',\n  namespace: NS.XLINK\n}], ['xml:base', {\n  prefix: 'xml',\n  name: 'base',\n  namespace: NS.XML\n}], ['xml:lang', {\n  prefix: 'xml',\n  name: 'lang',\n  namespace: NS.XML\n}], ['xml:space', {\n  prefix: 'xml',\n  name: 'space',\n  namespace: NS.XML\n}], ['xmlns', {\n  prefix: '',\n  name: 'xmlns',\n  namespace: NS.XMLNS\n}], ['xmlns:xlink', {\n  prefix: 'xmlns',\n  name: 'xlink',\n  namespace: NS.XMLNS\n}]]);\n//SVG tag names adjustment map\nexport const SVG_TAG_NAMES_ADJUSTMENT_MAP = new Map(['altGlyph', 'altGlyphDef', 'altGlyphItem', 'animateColor', 'animateMotion', 'animateTransform', 'clipPath', 'feBlend', 'feColorMatrix', 'feComponentTransfer', 'feComposite', 'feConvolveMatrix', 'feDiffuseLighting', 'feDisplacementMap', 'feDistantLight', 'feFlood', 'feFuncA', 'feFuncB', 'feFuncG', 'feFuncR', 'feGaussianBlur', 'feImage', 'feMerge', 'feMergeNode', 'feMorphology', 'feOffset', 'fePointLight', 'feSpecularLighting', 'feSpotLight', 'feTile', 'feTurbulence', 'foreignObject', 'glyphRef', 'linearGradient', 'radialGradient', 'textPath'].map(tn => [tn.toLowerCase(), tn]));\n//Tags that causes exit from foreign content\nconst EXITS_FOREIGN_CONTENT = new Set([$.B, $.BIG, $.BLOCKQUOTE, $.BODY, $.BR, $.CENTER, $.CODE, $.DD, $.DIV, $.DL, $.DT, $.EM, $.EMBED, $.H1, $.H2, $.H3, $.H4, $.H5, $.H6, $.HEAD, $.HR, $.I, $.IMG, $.LI, $.LISTING, $.MENU, $.META, $.NOBR, $.OL, $.P, $.PRE, $.RUBY, $.S, $.SMALL, $.SPAN, $.STRONG, $.STRIKE, $.SUB, $.SUP, $.TABLE, $.TT, $.U, $.UL, $.VAR]);\n//Check exit from foreign content\nexport function causesExit(startTagToken) {\n  const tn = startTagToken.tagID;\n  const isFontWithAttrs = tn === $.FONT && startTagToken.attrs.some(({\n    name\n  }) => name === ATTRS.COLOR || name === ATTRS.SIZE || name === ATTRS.FACE);\n  return isFontWithAttrs || EXITS_FOREIGN_CONTENT.has(tn);\n}\n//Token adjustments\nexport function adjustTokenMathMLAttrs(token) {\n  for (let i = 0; i < token.attrs.length; i++) {\n    if (token.attrs[i].name === DEFINITION_URL_ATTR) {\n      token.attrs[i].name = ADJUSTED_DEFINITION_URL_ATTR;\n      break;\n    }\n  }\n}\nexport function adjustTokenSVGAttrs(token) {\n  for (let i = 0; i < token.attrs.length; i++) {\n    const adjustedAttrName = SVG_ATTRS_ADJUSTMENT_MAP.get(token.attrs[i].name);\n    if (adjustedAttrName != null) {\n      token.attrs[i].name = adjustedAttrName;\n    }\n  }\n}\nexport function adjustTokenXMLAttrs(token) {\n  for (let i = 0; i < token.attrs.length; i++) {\n    const adjustedAttrEntry = XML_ATTRS_ADJUSTMENT_MAP.get(token.attrs[i].name);\n    if (adjustedAttrEntry) {\n      token.attrs[i].prefix = adjustedAttrEntry.prefix;\n      token.attrs[i].name = adjustedAttrEntry.name;\n      token.attrs[i].namespace = adjustedAttrEntry.namespace;\n    }\n  }\n}\nexport function adjustTokenSVGTagName(token) {\n  const adjustedTagName = SVG_TAG_NAMES_ADJUSTMENT_MAP.get(token.tagName);\n  if (adjustedTagName != null) {\n    token.tagName = adjustedTagName;\n    token.tagID = getTagID(token.tagName);\n  }\n}\n//Integration points\nfunction isMathMLTextIntegrationPoint(tn, ns) {\n  return ns === NS.MATHML && (tn === $.MI || tn === $.MO || tn === $.MN || tn === $.MS || tn === $.MTEXT);\n}\nfunction isHtmlIntegrationPoint(tn, ns, attrs) {\n  if (ns === NS.MATHML && tn === $.ANNOTATION_XML) {\n    for (let i = 0; i < attrs.length; i++) {\n      if (attrs[i].name === ATTRS.ENCODING) {\n        const value = attrs[i].value.toLowerCase();\n        return value === MIME_TYPES.TEXT_HTML || value === MIME_TYPES.APPLICATION_XML;\n      }\n    }\n  }\n  return ns === NS.SVG && (tn === $.FOREIGN_OBJECT || tn === $.DESC || tn === $.TITLE);\n}\nexport function isIntegrationPoint(tn, ns, attrs, foreignNS) {\n  return (!foreignNS || foreignNS === NS.HTML) && isHtmlIntegrationPoint(tn, ns, attrs) || (!foreignNS || foreignNS === NS.MATHML) && isMathMLTextIntegrationPoint(tn, ns);\n}\n//# sourceMappingURL=foreign-content.js.map","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}