{"ast":null,"code":"/**\n * @license\n * Copyright 2017 Google Inc.\n * SPDX-License-Identifier: Apache-2.0\n */\nimport { filter, from, fromEvent, map, mergeMap, NEVER, Observable, timer } from '../../third_party/rxjs/rxjs.js';\nimport { environment } from '../environment.js';\nimport { packageVersion } from '../generated/version.js';\nimport { assert } from '../util/assert.js';\nimport { mergeUint8Arrays } from '../util/encoding.js';\nimport { debug } from './Debug.js';\nimport { TimeoutError } from './Errors.js';\nimport { paperFormats } from './PDFOptions.js';\n/**\n * @internal\n */\nexport const debugError = debug('puppeteer:error');\n/**\n * @internal\n */\nexport const DEFAULT_VIEWPORT = Object.freeze({\n  width: 800,\n  height: 600\n});\n/**\n * @internal\n */\nconst SOURCE_URL = Symbol('Source URL for Puppeteer evaluation scripts');\n/**\n * @internal\n */\nexport class PuppeteerURL {\n  static INTERNAL_URL = 'pptr:internal';\n  static fromCallSite(functionName, site) {\n    const url = new PuppeteerURL();\n    url.#functionName = functionName;\n    url.#siteString = site.toString();\n    return url;\n  }\n  static parse = url => {\n    url = url.slice('pptr:'.length);\n    const [functionName = '', siteString = ''] = url.split(';');\n    const puppeteerUrl = new PuppeteerURL();\n    puppeteerUrl.#functionName = functionName;\n    puppeteerUrl.#siteString = decodeURIComponent(siteString);\n    return puppeteerUrl;\n  };\n  static isPuppeteerURL = url => {\n    return url.startsWith('pptr:');\n  };\n  #functionName;\n  #siteString;\n  get functionName() {\n    return this.#functionName;\n  }\n  get siteString() {\n    return this.#siteString;\n  }\n  toString() {\n    return `pptr:${[this.#functionName, encodeURIComponent(this.#siteString)].join(';')}`;\n  }\n}\n/**\n * @internal\n */\nexport const withSourcePuppeteerURLIfNone = (functionName, object) => {\n  if (Object.prototype.hasOwnProperty.call(object, SOURCE_URL)) {\n    return object;\n  }\n  const original = Error.prepareStackTrace;\n  Error.prepareStackTrace = (_, stack) => {\n    // First element is the function.\n    // Second element is the caller of this function.\n    // Third element is the caller of the caller of this function\n    // which is precisely what we want.\n    return stack[2];\n  };\n  const site = new Error().stack;\n  Error.prepareStackTrace = original;\n  return Object.assign(object, {\n    [SOURCE_URL]: PuppeteerURL.fromCallSite(functionName, site)\n  });\n};\n/**\n * @internal\n */\nexport const getSourcePuppeteerURLIfAvailable = object => {\n  if (Object.prototype.hasOwnProperty.call(object, SOURCE_URL)) {\n    return object[SOURCE_URL];\n  }\n  return undefined;\n};\n/**\n * @internal\n */\nexport const isString = obj => {\n  return typeof obj === 'string' || obj instanceof String;\n};\n/**\n * @internal\n */\nexport const isNumber = obj => {\n  return typeof obj === 'number' || obj instanceof Number;\n};\n/**\n * @internal\n */\nexport const isPlainObject = obj => {\n  return typeof obj === 'object' && obj?.constructor === Object;\n};\n/**\n * @internal\n */\nexport const isRegExp = obj => {\n  return typeof obj === 'object' && obj?.constructor === RegExp;\n};\n/**\n * @internal\n */\nexport const isDate = obj => {\n  return typeof obj === 'object' && obj?.constructor === Date;\n};\n/**\n * @internal\n */\nexport function evaluationString(fun, ...args) {\n  if (isString(fun)) {\n    assert(args.length === 0, 'Cannot evaluate a string with arguments');\n    return fun;\n  }\n  function serializeArgument(arg) {\n    if (Object.is(arg, undefined)) {\n      return 'undefined';\n    }\n    return JSON.stringify(arg);\n  }\n  return `(${fun})(${args.map(serializeArgument).join(',')})`;\n}\n/**\n * @internal\n */\nexport async function getReadableAsTypedArray(readable, path) {\n  const buffers = [];\n  const reader = readable.getReader();\n  if (path) {\n    const fileHandle = await environment.value.fs.promises.open(path, 'w+');\n    try {\n      while (true) {\n        const {\n          done,\n          value\n        } = await reader.read();\n        if (done) {\n          break;\n        }\n        buffers.push(value);\n        await fileHandle.writeFile(value);\n      }\n    } finally {\n      await fileHandle.close();\n    }\n  } else {\n    while (true) {\n      const {\n        done,\n        value\n      } = await reader.read();\n      if (done) {\n        break;\n      }\n      buffers.push(value);\n    }\n  }\n  try {\n    const concat = mergeUint8Arrays(buffers);\n    if (concat.length === 0) {\n      return null;\n    }\n    return concat;\n  } catch (error) {\n    debugError(error);\n    return null;\n  }\n}\n/**\n * @internal\n */\n/**\n * @internal\n */\nexport async function getReadableFromProtocolStream(client, handle) {\n  return new ReadableStream({\n    async pull(controller) {\n      function getUnit8Array(data, isBase64) {\n        if (isBase64) {\n          return Uint8Array.from(atob(data), m => {\n            return m.codePointAt(0);\n          });\n        }\n        const encoder = new TextEncoder();\n        return encoder.encode(data);\n      }\n      const {\n        data,\n        base64Encoded,\n        eof\n      } = await client.send('IO.read', {\n        handle\n      });\n      controller.enqueue(getUnit8Array(data, base64Encoded ?? false));\n      if (eof) {\n        await client.send('IO.close', {\n          handle\n        });\n        controller.close();\n      }\n    }\n  });\n}\n/**\n * @internal\n */\nexport function validateDialogType(type) {\n  let dialogType = null;\n  const validDialogTypes = new Set(['alert', 'confirm', 'prompt', 'beforeunload']);\n  if (validDialogTypes.has(type)) {\n    dialogType = type;\n  }\n  assert(dialogType, `Unknown javascript dialog type: ${type}`);\n  return dialogType;\n}\n/**\n * @internal\n */\nexport function timeout(ms, cause) {\n  return ms === 0 ? NEVER : timer(ms).pipe(map(() => {\n    throw new TimeoutError(`Timed out after waiting ${ms}ms`, {\n      cause\n    });\n  }));\n}\n/**\n * @internal\n */\nexport const UTILITY_WORLD_NAME = '__puppeteer_utility_world__' + packageVersion;\n/**\n * @internal\n */\nexport const SOURCE_URL_REGEX = /^[\\040\\t]*\\/\\/[@#] sourceURL=\\s*(\\S*?)\\s*$/m;\n/**\n * @internal\n */\nexport function getSourceUrlComment(url) {\n  return `//# sourceURL=${url}`;\n}\n/**\n * @internal\n */\nexport const NETWORK_IDLE_TIME = 500;\n/**\n * @internal\n */\nexport function parsePDFOptions(options = {}, lengthUnit = 'in') {\n  const defaults = {\n    scale: 1,\n    displayHeaderFooter: false,\n    headerTemplate: '',\n    footerTemplate: '',\n    printBackground: false,\n    landscape: false,\n    pageRanges: '',\n    preferCSSPageSize: false,\n    omitBackground: false,\n    outline: false,\n    tagged: true,\n    waitForFonts: true\n  };\n  let width = 8.5;\n  let height = 11;\n  if (options.format) {\n    const format = paperFormats[options.format.toLowerCase()];\n    assert(format, 'Unknown paper format: ' + options.format);\n    width = format.width;\n    height = format.height;\n  } else {\n    width = convertPrintParameterToInches(options.width, lengthUnit) ?? width;\n    height = convertPrintParameterToInches(options.height, lengthUnit) ?? height;\n  }\n  const margin = {\n    top: convertPrintParameterToInches(options.margin?.top, lengthUnit) || 0,\n    left: convertPrintParameterToInches(options.margin?.left, lengthUnit) || 0,\n    bottom: convertPrintParameterToInches(options.margin?.bottom, lengthUnit) || 0,\n    right: convertPrintParameterToInches(options.margin?.right, lengthUnit) || 0\n  };\n  // Quirk https://bugs.chromium.org/p/chromium/issues/detail?id=840455#c44\n  if (options.outline) {\n    options.tagged = true;\n  }\n  return {\n    ...defaults,\n    ...options,\n    width,\n    height,\n    margin\n  };\n}\n/**\n * @internal\n */\nexport const unitToPixels = {\n  px: 1,\n  in: 96,\n  cm: 37.8,\n  mm: 3.78\n};\nfunction convertPrintParameterToInches(parameter, lengthUnit = 'in') {\n  if (typeof parameter === 'undefined') {\n    return undefined;\n  }\n  let pixels;\n  if (isNumber(parameter)) {\n    // Treat numbers as pixel values to be aligned with phantom's paperSize.\n    pixels = parameter;\n  } else if (isString(parameter)) {\n    const text = parameter;\n    let unit = text.substring(text.length - 2).toLowerCase();\n    let valueText = '';\n    if (unit in unitToPixels) {\n      valueText = text.substring(0, text.length - 2);\n    } else {\n      // In case of unknown unit try to parse the whole parameter as number of pixels.\n      // This is consistent with phantom's paperSize behavior.\n      unit = 'px';\n      valueText = text;\n    }\n    const value = Number(valueText);\n    assert(!isNaN(value), 'Failed to parse parameter value: ' + text);\n    pixels = value * unitToPixels[unit];\n  } else {\n    throw new Error('page.pdf() Cannot handle parameter type: ' + typeof parameter);\n  }\n  return pixels / unitToPixels[lengthUnit];\n}\n/**\n * @internal\n */\nexport function fromEmitterEvent(emitter, eventName) {\n  return new Observable(subscriber => {\n    const listener = event => {\n      subscriber.next(event);\n    };\n    emitter.on(eventName, listener);\n    return () => {\n      emitter.off(eventName, listener);\n    };\n  });\n}\n/**\n * @internal\n */\nexport function fromAbortSignal(signal, cause) {\n  return signal ? fromEvent(signal, 'abort').pipe(map(() => {\n    if (signal.reason instanceof Error) {\n      signal.reason.cause = cause;\n      throw signal.reason;\n    }\n    throw new Error(signal.reason, {\n      cause\n    });\n  })) : NEVER;\n}\n/**\n * @internal\n */\nexport function filterAsync(predicate) {\n  return mergeMap(value => {\n    return from(Promise.resolve(predicate(value))).pipe(filter(isMatch => {\n      return isMatch;\n    }), map(() => {\n      return value;\n    }));\n  });\n}","map":{"version":3,"names":["filter","from","fromEvent","map","mergeMap","NEVER","Observable","timer","environment","packageVersion","assert","mergeUint8Arrays","debug","TimeoutError","paperFormats","debugError","DEFAULT_VIEWPORT","Object","freeze","width","height","SOURCE_URL","Symbol","PuppeteerURL","INTERNAL_URL","fromCallSite","functionName","site","url","siteString","toString","parse","slice","length","split","puppeteerUrl","decodeURIComponent","isPuppeteerURL","startsWith","encodeURIComponent","join","withSourcePuppeteerURLIfNone","object","prototype","hasOwnProperty","call","original","Error","prepareStackTrace","_","stack","assign","getSourcePuppeteerURLIfAvailable","undefined","isString","obj","String","isNumber","Number","isPlainObject","constructor","isRegExp","RegExp","isDate","Date","evaluationString","fun","args","serializeArgument","arg","is","JSON","stringify","getReadableAsTypedArray","readable","path","buffers","reader","getReader","fileHandle","value","fs","promises","open","done","read","push","writeFile","close","concat","error","getReadableFromProtocolStream","client","handle","ReadableStream","pull","controller","getUnit8Array","data","isBase64","Uint8Array","atob","m","codePointAt","encoder","TextEncoder","encode","base64Encoded","eof","send","enqueue","validateDialogType","type","dialogType","validDialogTypes","Set","has","timeout","ms","cause","pipe","UTILITY_WORLD_NAME","SOURCE_URL_REGEX","getSourceUrlComment","NETWORK_IDLE_TIME","parsePDFOptions","options","lengthUnit","defaults","scale","displayHeaderFooter","headerTemplate","footerTemplate","printBackground","landscape","pageRanges","preferCSSPageSize","omitBackground","outline","tagged","waitForFonts","format","toLowerCase","convertPrintParameterToInches","margin","top","left","bottom","right","unitToPixels","px","in","cm","mm","parameter","pixels","text","unit","substring","valueText","isNaN","fromEmitterEvent","emitter","eventName","subscriber","listener","event","next","on","off","fromAbortSignal","signal","reason","filterAsync","predicate","Promise","resolve","isMatch"],"sources":["C:\\Users\\raffy\\Desktop\\test\\node_modules\\puppeteer-core\\src\\common\\util.ts"],"sourcesContent":["/**\n * @license\n * Copyright 2017 Google Inc.\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport type {OperatorFunction} from '../../third_party/rxjs/rxjs.js';\nimport {\n  filter,\n  from,\n  fromEvent,\n  map,\n  mergeMap,\n  NEVER,\n  Observable,\n  timer,\n} from '../../third_party/rxjs/rxjs.js';\nimport type {CDPSession} from '../api/CDPSession.js';\nimport {environment} from '../environment.js';\nimport {packageVersion} from '../generated/version.js';\nimport {assert} from '../util/assert.js';\nimport {mergeUint8Arrays} from '../util/encoding.js';\n\nimport {debug} from './Debug.js';\nimport {TimeoutError} from './Errors.js';\nimport type {EventEmitter, EventType} from './EventEmitter.js';\nimport type {\n  LowerCasePaperFormat,\n  ParsedPDFOptions,\n  PDFOptions,\n} from './PDFOptions.js';\nimport {paperFormats} from './PDFOptions.js';\n\n/**\n * @internal\n */\nexport const debugError = debug('puppeteer:error');\n\n/**\n * @internal\n */\nexport const DEFAULT_VIEWPORT = Object.freeze({width: 800, height: 600});\n\n/**\n * @internal\n */\nconst SOURCE_URL = Symbol('Source URL for Puppeteer evaluation scripts');\n\n/**\n * @internal\n */\nexport class PuppeteerURL {\n  static INTERNAL_URL = 'pptr:internal';\n\n  static fromCallSite(\n    functionName: string,\n    site: NodeJS.CallSite\n  ): PuppeteerURL {\n    const url = new PuppeteerURL();\n    url.#functionName = functionName;\n    url.#siteString = site.toString();\n    return url;\n  }\n\n  static parse = (url: string): PuppeteerURL => {\n    url = url.slice('pptr:'.length);\n    const [functionName = '', siteString = ''] = url.split(';');\n    const puppeteerUrl = new PuppeteerURL();\n    puppeteerUrl.#functionName = functionName;\n    puppeteerUrl.#siteString = decodeURIComponent(siteString);\n    return puppeteerUrl;\n  };\n\n  static isPuppeteerURL = (url: string): boolean => {\n    return url.startsWith('pptr:');\n  };\n\n  #functionName!: string;\n  #siteString!: string;\n\n  get functionName(): string {\n    return this.#functionName;\n  }\n\n  get siteString(): string {\n    return this.#siteString;\n  }\n\n  toString(): string {\n    return `pptr:${[\n      this.#functionName,\n      encodeURIComponent(this.#siteString),\n    ].join(';')}`;\n  }\n}\n\n/**\n * @internal\n */\nexport const withSourcePuppeteerURLIfNone = <T extends NonNullable<unknown>>(\n  functionName: string,\n  object: T\n): T => {\n  if (Object.prototype.hasOwnProperty.call(object, SOURCE_URL)) {\n    return object;\n  }\n  const original = Error.prepareStackTrace;\n  Error.prepareStackTrace = (_, stack) => {\n    // First element is the function.\n    // Second element is the caller of this function.\n    // Third element is the caller of the caller of this function\n    // which is precisely what we want.\n    return stack[2];\n  };\n  const site = new Error().stack as unknown as NodeJS.CallSite;\n  Error.prepareStackTrace = original;\n  return Object.assign(object, {\n    [SOURCE_URL]: PuppeteerURL.fromCallSite(functionName, site),\n  });\n};\n\n/**\n * @internal\n */\nexport const getSourcePuppeteerURLIfAvailable = <\n  T extends NonNullable<unknown>,\n>(\n  object: T\n): PuppeteerURL | undefined => {\n  if (Object.prototype.hasOwnProperty.call(object, SOURCE_URL)) {\n    return object[SOURCE_URL as keyof T] as PuppeteerURL;\n  }\n  return undefined;\n};\n\n/**\n * @internal\n */\nexport const isString = (obj: unknown): obj is string => {\n  return typeof obj === 'string' || obj instanceof String;\n};\n\n/**\n * @internal\n */\nexport const isNumber = (obj: unknown): obj is number => {\n  return typeof obj === 'number' || obj instanceof Number;\n};\n\n/**\n * @internal\n */\nexport const isPlainObject = (obj: unknown): obj is Record<any, unknown> => {\n  return typeof obj === 'object' && obj?.constructor === Object;\n};\n\n/**\n * @internal\n */\nexport const isRegExp = (obj: unknown): obj is RegExp => {\n  return typeof obj === 'object' && obj?.constructor === RegExp;\n};\n\n/**\n * @internal\n */\nexport const isDate = (obj: unknown): obj is Date => {\n  return typeof obj === 'object' && obj?.constructor === Date;\n};\n\n/**\n * @internal\n */\nexport function evaluationString(\n  fun: Function | string,\n  ...args: unknown[]\n): string {\n  if (isString(fun)) {\n    assert(args.length === 0, 'Cannot evaluate a string with arguments');\n    return fun;\n  }\n\n  function serializeArgument(arg: unknown): string {\n    if (Object.is(arg, undefined)) {\n      return 'undefined';\n    }\n    return JSON.stringify(arg);\n  }\n\n  return `(${fun})(${args.map(serializeArgument).join(',')})`;\n}\n\n/**\n * @internal\n */\nexport async function getReadableAsTypedArray(\n  readable: ReadableStream<Uint8Array>,\n  path?: string\n): Promise<Uint8Array | null> {\n  const buffers: Uint8Array[] = [];\n  const reader = readable.getReader();\n  if (path) {\n    const fileHandle = await environment.value.fs.promises.open(path, 'w+');\n    try {\n      while (true) {\n        const {done, value} = await reader.read();\n        if (done) {\n          break;\n        }\n        buffers.push(value);\n        await fileHandle.writeFile(value);\n      }\n    } finally {\n      await fileHandle.close();\n    }\n  } else {\n    while (true) {\n      const {done, value} = await reader.read();\n      if (done) {\n        break;\n      }\n      buffers.push(value);\n    }\n  }\n  try {\n    const concat = mergeUint8Arrays(buffers);\n    if (concat.length === 0) {\n      return null;\n    }\n    return concat;\n  } catch (error) {\n    debugError(error);\n    return null;\n  }\n}\n\n/**\n * @internal\n */\n\n/**\n * @internal\n */\nexport async function getReadableFromProtocolStream(\n  client: CDPSession,\n  handle: string\n): Promise<ReadableStream<Uint8Array>> {\n  return new ReadableStream({\n    async pull(controller) {\n      function getUnit8Array(data: string, isBase64: boolean): Uint8Array {\n        if (isBase64) {\n          return Uint8Array.from(atob(data), m => {\n            return m.codePointAt(0)!;\n          });\n        }\n        const encoder = new TextEncoder();\n        return encoder.encode(data);\n      }\n\n      const {data, base64Encoded, eof} = await client.send('IO.read', {\n        handle,\n      });\n\n      controller.enqueue(getUnit8Array(data, base64Encoded ?? false));\n      if (eof) {\n        await client.send('IO.close', {handle});\n        controller.close();\n      }\n    },\n  });\n}\n\n/**\n * @internal\n */\nexport function validateDialogType(\n  type: string\n): 'alert' | 'confirm' | 'prompt' | 'beforeunload' {\n  let dialogType = null;\n  const validDialogTypes = new Set([\n    'alert',\n    'confirm',\n    'prompt',\n    'beforeunload',\n  ]);\n\n  if (validDialogTypes.has(type)) {\n    dialogType = type;\n  }\n  assert(dialogType, `Unknown javascript dialog type: ${type}`);\n  return dialogType as 'alert' | 'confirm' | 'prompt' | 'beforeunload';\n}\n\n/**\n * @internal\n */\nexport function timeout(ms: number, cause?: Error): Observable<never> {\n  return ms === 0\n    ? NEVER\n    : timer(ms).pipe(\n        map(() => {\n          throw new TimeoutError(`Timed out after waiting ${ms}ms`, {cause});\n        })\n      );\n}\n\n/**\n * @internal\n */\nexport const UTILITY_WORLD_NAME =\n  '__puppeteer_utility_world__' + packageVersion;\n\n/**\n * @internal\n */\nexport const SOURCE_URL_REGEX = /^[\\040\\t]*\\/\\/[@#] sourceURL=\\s*(\\S*?)\\s*$/m;\n/**\n * @internal\n */\nexport function getSourceUrlComment(url: string): string {\n  return `//# sourceURL=${url}`;\n}\n\n/**\n * @internal\n */\nexport const NETWORK_IDLE_TIME = 500;\n\n/**\n * @internal\n */\nexport function parsePDFOptions(\n  options: PDFOptions = {},\n  lengthUnit: 'in' | 'cm' = 'in'\n): ParsedPDFOptions {\n  const defaults: Omit<ParsedPDFOptions, 'width' | 'height' | 'margin'> = {\n    scale: 1,\n    displayHeaderFooter: false,\n    headerTemplate: '',\n    footerTemplate: '',\n    printBackground: false,\n    landscape: false,\n    pageRanges: '',\n    preferCSSPageSize: false,\n    omitBackground: false,\n    outline: false,\n    tagged: true,\n    waitForFonts: true,\n  };\n\n  let width = 8.5;\n  let height = 11;\n  if (options.format) {\n    const format =\n      paperFormats[options.format.toLowerCase() as LowerCasePaperFormat];\n    assert(format, 'Unknown paper format: ' + options.format);\n    width = format.width;\n    height = format.height;\n  } else {\n    width = convertPrintParameterToInches(options.width, lengthUnit) ?? width;\n    height =\n      convertPrintParameterToInches(options.height, lengthUnit) ?? height;\n  }\n\n  const margin = {\n    top: convertPrintParameterToInches(options.margin?.top, lengthUnit) || 0,\n    left: convertPrintParameterToInches(options.margin?.left, lengthUnit) || 0,\n    bottom:\n      convertPrintParameterToInches(options.margin?.bottom, lengthUnit) || 0,\n    right:\n      convertPrintParameterToInches(options.margin?.right, lengthUnit) || 0,\n  };\n\n  // Quirk https://bugs.chromium.org/p/chromium/issues/detail?id=840455#c44\n  if (options.outline) {\n    options.tagged = true;\n  }\n\n  return {\n    ...defaults,\n    ...options,\n    width,\n    height,\n    margin,\n  };\n}\n\n/**\n * @internal\n */\nexport const unitToPixels = {\n  px: 1,\n  in: 96,\n  cm: 37.8,\n  mm: 3.78,\n};\n\nfunction convertPrintParameterToInches(\n  parameter?: string | number,\n  lengthUnit: 'in' | 'cm' = 'in'\n): number | undefined {\n  if (typeof parameter === 'undefined') {\n    return undefined;\n  }\n  let pixels;\n  if (isNumber(parameter)) {\n    // Treat numbers as pixel values to be aligned with phantom's paperSize.\n    pixels = parameter;\n  } else if (isString(parameter)) {\n    const text = parameter;\n    let unit = text.substring(text.length - 2).toLowerCase();\n    let valueText = '';\n    if (unit in unitToPixels) {\n      valueText = text.substring(0, text.length - 2);\n    } else {\n      // In case of unknown unit try to parse the whole parameter as number of pixels.\n      // This is consistent with phantom's paperSize behavior.\n      unit = 'px';\n      valueText = text;\n    }\n    const value = Number(valueText);\n    assert(!isNaN(value), 'Failed to parse parameter value: ' + text);\n    pixels = value * unitToPixels[unit as keyof typeof unitToPixels];\n  } else {\n    throw new Error(\n      'page.pdf() Cannot handle parameter type: ' + typeof parameter\n    );\n  }\n  return pixels / unitToPixels[lengthUnit];\n}\n\n/**\n * @internal\n */\nexport function fromEmitterEvent<\n  Events extends Record<EventType, unknown>,\n  Event extends keyof Events,\n>(emitter: EventEmitter<Events>, eventName: Event): Observable<Events[Event]> {\n  return new Observable(subscriber => {\n    const listener = (event: Events[Event]) => {\n      subscriber.next(event);\n    };\n    emitter.on(eventName, listener);\n    return () => {\n      emitter.off(eventName, listener);\n    };\n  });\n}\n\n/**\n * @internal\n */\nexport function fromAbortSignal(\n  signal?: AbortSignal,\n  cause?: Error\n): Observable<never> {\n  return signal\n    ? fromEvent(signal, 'abort').pipe(\n        map(() => {\n          if (signal.reason instanceof Error) {\n            signal.reason.cause = cause;\n            throw signal.reason;\n          }\n\n          throw new Error(signal.reason, {cause});\n        })\n      )\n    : NEVER;\n}\n\n/**\n * @internal\n */\nexport function filterAsync<T>(\n  predicate: (value: T) => boolean | PromiseLike<boolean>\n): OperatorFunction<T, T> {\n  return mergeMap<T, Observable<T>>((value): Observable<T> => {\n    return from(Promise.resolve(predicate(value))).pipe(\n      filter(isMatch => {\n        return isMatch;\n      }),\n      map(() => {\n        return value;\n      })\n    );\n  });\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}