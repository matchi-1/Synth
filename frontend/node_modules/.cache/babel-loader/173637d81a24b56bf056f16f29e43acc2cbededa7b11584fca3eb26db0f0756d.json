{"ast":null,"code":"/**\n * @license\n * Copyright 2024 Google Inc.\n * SPDX-License-Identifier: Apache-2.0\n */\nimport { TimeoutError } from '../common/Errors.js';\n/**\n * Creates and returns a deferred object along with the resolve/reject functions.\n *\n * If the deferred has not been resolved/rejected within the `timeout` period,\n * the deferred gets resolves with a timeout error. `timeout` has to be greater than 0 or\n * it is ignored.\n *\n * @internal\n */\nexport class Deferred {\n  static create(opts) {\n    return new Deferred(opts);\n  }\n  static async race(awaitables) {\n    const deferredWithTimeout = new Set();\n    try {\n      const promises = awaitables.map(value => {\n        if (value instanceof Deferred) {\n          if (value.#timeoutId) {\n            deferredWithTimeout.add(value);\n          }\n          return value.valueOrThrow();\n        }\n        return value;\n      });\n      // eslint-disable-next-line no-restricted-syntax\n      return await Promise.race(promises);\n    } finally {\n      for (const deferred of deferredWithTimeout) {\n        // We need to stop the timeout else\n        // Node.JS will keep running the event loop till the\n        // timer executes\n        deferred.reject(new Error('Timeout cleared'));\n      }\n    }\n  }\n  #isResolved = false;\n  #isRejected = false;\n  #value;\n  // SAFETY: This is ensured by #taskPromise.\n  #resolve;\n  #taskPromise = new Promise(resolve => {\n    this.#resolve = resolve;\n  });\n  #timeoutId;\n  #timeoutError;\n  constructor(opts) {\n    if (opts && opts.timeout > 0) {\n      this.#timeoutError = new TimeoutError(opts.message);\n      this.#timeoutId = setTimeout(() => {\n        this.reject(this.#timeoutError);\n      }, opts.timeout);\n    }\n  }\n  #finish(value) {\n    clearTimeout(this.#timeoutId);\n    this.#value = value;\n    this.#resolve();\n  }\n  resolve(value) {\n    if (this.#isRejected || this.#isResolved) {\n      return;\n    }\n    this.#isResolved = true;\n    this.#finish(value);\n  }\n  reject(error) {\n    if (this.#isRejected || this.#isResolved) {\n      return;\n    }\n    this.#isRejected = true;\n    this.#finish(error);\n  }\n  resolved() {\n    return this.#isResolved;\n  }\n  finished() {\n    return this.#isResolved || this.#isRejected;\n  }\n  value() {\n    return this.#value;\n  }\n  #promise;\n  valueOrThrow() {\n    if (!this.#promise) {\n      this.#promise = (async () => {\n        await this.#taskPromise;\n        if (this.#isRejected) {\n          throw this.#value;\n        }\n        return this.#value;\n      })();\n    }\n    return this.#promise;\n  }\n}","map":{"version":3,"names":["TimeoutError","Deferred","create","opts","race","awaitables","deferredWithTimeout","Set","promises","map","value","timeoutId","add","valueOrThrow","Promise","deferred","reject","Error","isResolved","isRejected","resolve","taskPromise","timeoutError","constructor","timeout","message","setTimeout","finish","#finish","clearTimeout","error","resolved","finished","promise"],"sources":["C:\\Users\\raffy\\Desktop\\test\\node_modules\\puppeteer-core\\src\\util\\Deferred.ts"],"sourcesContent":["/**\n * @license\n * Copyright 2024 Google Inc.\n * SPDX-License-Identifier: Apache-2.0\n */\nimport {TimeoutError} from '../common/Errors.js';\n\n/**\n * @internal\n */\nexport interface DeferredOptions {\n  message: string;\n  timeout: number;\n}\n\n/**\n * Creates and returns a deferred object along with the resolve/reject functions.\n *\n * If the deferred has not been resolved/rejected within the `timeout` period,\n * the deferred gets resolves with a timeout error. `timeout` has to be greater than 0 or\n * it is ignored.\n *\n * @internal\n */\nexport class Deferred<T, V extends Error = Error> {\n  static create<R, X extends Error = Error>(\n    opts?: DeferredOptions\n  ): Deferred<R, X> {\n    return new Deferred<R, X>(opts);\n  }\n\n  static async race<R>(\n    awaitables: Array<Promise<R> | Deferred<R>>\n  ): Promise<R> {\n    const deferredWithTimeout = new Set<Deferred<R>>();\n    try {\n      const promises = awaitables.map(value => {\n        if (value instanceof Deferred) {\n          if (value.#timeoutId) {\n            deferredWithTimeout.add(value);\n          }\n\n          return value.valueOrThrow();\n        }\n\n        return value;\n      });\n      // eslint-disable-next-line no-restricted-syntax\n      return await Promise.race(promises);\n    } finally {\n      for (const deferred of deferredWithTimeout) {\n        // We need to stop the timeout else\n        // Node.JS will keep running the event loop till the\n        // timer executes\n        deferred.reject(new Error('Timeout cleared'));\n      }\n    }\n  }\n\n  #isResolved = false;\n  #isRejected = false;\n  #value: T | V | TimeoutError | undefined;\n  // SAFETY: This is ensured by #taskPromise.\n  #resolve!: (value: void) => void;\n  #taskPromise = new Promise<void>(resolve => {\n    this.#resolve = resolve;\n  });\n  #timeoutId: ReturnType<typeof setTimeout> | undefined;\n  #timeoutError: TimeoutError | undefined;\n\n  constructor(opts?: DeferredOptions) {\n    if (opts && opts.timeout > 0) {\n      this.#timeoutError = new TimeoutError(opts.message);\n      this.#timeoutId = setTimeout(() => {\n        this.reject(this.#timeoutError!);\n      }, opts.timeout);\n    }\n  }\n\n  #finish(value: T | V | TimeoutError) {\n    clearTimeout(this.#timeoutId);\n    this.#value = value;\n    this.#resolve();\n  }\n\n  resolve(value: T): void {\n    if (this.#isRejected || this.#isResolved) {\n      return;\n    }\n    this.#isResolved = true;\n    this.#finish(value);\n  }\n\n  reject(error: V | TimeoutError): void {\n    if (this.#isRejected || this.#isResolved) {\n      return;\n    }\n    this.#isRejected = true;\n    this.#finish(error);\n  }\n\n  resolved(): boolean {\n    return this.#isResolved;\n  }\n\n  finished(): boolean {\n    return this.#isResolved || this.#isRejected;\n  }\n\n  value(): T | V | TimeoutError | undefined {\n    return this.#value;\n  }\n\n  #promise: Promise<T> | undefined;\n  valueOrThrow(): Promise<T> {\n    if (!this.#promise) {\n      this.#promise = (async () => {\n        await this.#taskPromise;\n        if (this.#isRejected) {\n          throw this.#value;\n        }\n        return this.#value as T;\n      })();\n    }\n    return this.#promise;\n  }\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}